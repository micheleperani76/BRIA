{# ==============================================================================
   REFERENTI - File satellite (estratto da dettaglio.html)
   Data estrazione: 2026-02-10 16:41
   Generato da: modularizza_dettaglio.py
   ============================================================================== #}
<div class="card mb-3">
    <div class="card-header py-2 d-flex justify-content-between align-items-center">
        <span><i class="bi bi-people"></i> Referenti</span>
        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalNuovoReferente">
            <i class="bi bi-plus"></i> Aggiungi
        </button>
    </div>
    <div class="card-body p-0">
        {% if referenti %}
        <div class="table-responsive">
            <table class="table table-hover table-sm mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 15%">Nome</th>
                        <th style="width: 10%">Ruolo</th>
                        <th style="width: 10%">Cellulare</th>
                        <th style="width: 12%">Telefono</th>
                        <th style="width: 18%">Email Principale</th>
                        <th style="width: 15%">Email Secondarie</th>
                        <th style="width: 5%">in</th>
                        <th style="width: 5%">Azioni</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ref in referenti %}
                    <tr data-referente-id="{{ ref.id }}">
                        <td>
                            {% if ref.principale %}<i class="bi bi-star-fill text-warning me-1" title="Referente principale"></i>{% endif %}
                            <strong>{{ ref.cognome or '' }}</strong> {{ ref.nome or '' }}
                        </td>
                        <td>{% if ref.ruolo %}<span class="badge bg-info">{{ ref.ruolo }}</span>{% endif %}</td>
                        <td>{% if ref.cellulare %}<a href="tel:{{ ref.cellulare }}">{{ ref.cellulare }}</a>{% endif %}</td>
                        <td>
                            {% if ref.telefono %}<a href="tel:{{ ref.telefono }}">{{ ref.telefono }}</a>{% endif %}
                            {% if ref.interno %}<small class="text-muted">int.{{ ref.interno }}</small>{% endif %}
                        </td>
                        <td>{% if ref.email_principale %}<a href="mailto:{{ ref.email_principale }}">{{ ref.email_principale }}</a>{% endif %}</td>
                        <td><small>{{ ref.email_secondarie or '' }}</small></td>
                        <td>{% if ref.linkedin %}<a href="{{ ref.linkedin }}" target="_blank" class="text-primary"><i class="bi bi-linkedin"></i></a>{% endif %}</td>
                        <td>
                            <button type="button" class="btn btn-outline-primary btn-sm py-0 px-1"
                                    onclick="modificaReferente({{ ref.id }}, '{{ ref.ruolo|default('', true)|replace("'", "\\'")|e }}', '{{ ref.nome|default('', true)|replace("'", "\\'")|e }}', '{{ ref.cognome|default('', true)|replace("'", "\\'")|e }}', '{{ ref.telefono|default('', true)|e }}', '{{ ref.interno|default('', true)|e }}', '{{ ref.cellulare|default('', true)|e }}', '{{ ref.email_principale|default('', true)|e }}', '{{ ref.email_secondarie|default('', true)|replace("'", "\\'")|e }}', '{{ ref.linkedin|default('', true)|e }}', '{{ ref.note|default('', true)|replace("'", "\\'")|replace("\n", " ")|e }}', {{ ref.principale|default(0, true) }})" title="Modifica">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button type="button" class="btn btn-outline-danger btn-sm py-0 px-1"
                                    onclick="eliminaReferente({{ ref.id }}, '{{ ref.cognome|default('', true)|e }} {{ ref.nome|default('', true)|e }}')" title="Elimina">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% if ref.note %}
                    <tr class="table-light">
                        <td colspan="8" class="py-1 ps-4"><small class="text-muted"><i class="bi bi-chat-left-text"></i> {{ ref.note }}</small></td>
                    </tr>
                    {% endif %}
                    {% if ref.sedi_collegate %}
                    <tr class="table-light">
                        <td colspan="8" class="py-1 ps-4">
                            <small class="text-muted"><i class="bi bi-geo-alt me-1"></i>Sedi:</small>
                            {% for sede in ref.sedi_collegate %}
                            <span class="badge bg-secondary ms-1" style="font-size: 0.7rem;">{{ sede.tipo_sede }}{% if sede.denominazione %} - {{ sede.denominazione }}{% endif %}{% if sede.citta %} ({{ sede.citta }}){% endif %}</span>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-muted text-center py-3">
            <i class="bi bi-people"></i> Nessun referente inserito
        </div>
        {% endif %}
    </div>
</div>
