<!-- ============================================================
     TRATTATIVE - Griglia Principale
     Versione: 1.0
     ============================================================ -->

<div class="card">
    <div class="card-body p-0">
        
        <!-- Tabella -->
        <div class="table-responsive">
            <table class="table table-hover table-sm mb-0" id="tabellaTrattative">
                <thead class="table-light sticky-top">
                    <tr>
                        <th style="width: 30px;"></th>
                        <th style="width: 18%;">Cliente</th>
                        <th style="width: 8%;">Noleggiatore</th>
                        <th style="width: 10%;">Veicolo</th>
                        <th style="width: 7%;">Tipologia</th>
                        <th style="width: 10%;">Tipo</th>
                        <th style="width: 35px;" class="text-center">Pz</th>
                        <th style="width: 9%;">Stato</th>
                        <th style="width: 70px;" class="text-center">Avanz.</th>
                        <th style="width: 85px;">Data Inizio</th>
                        <th style="width: 85px;">Data Chiusura</th>
                        <th style="width: 10%;">Commerciale</th>
                        <th style="width: 100px;">Azioni</th>
                    </tr>
                </thead>
                <tbody id="tbodyTrattative">
                    <!-- Popolato via JavaScript -->
                    <tr id="rigaCaricamento">
                        <td colspan="12" class="text-center py-4">
                            <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
                            <span class="ms-2">Caricamento...</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Paginazione -->
        <div class="d-flex justify-content-between align-items-center p-2 border-top">
            <div id="infoRisultati" class="small text-muted">
                <!-- Popolato via JS -->
            </div>
            <nav>
                <ul class="pagination pagination-sm mb-0" id="paginazione">
                    <!-- Popolato via JS -->
                </ul>
            </nav>
        </div>
        
    </div>
</div>

<!-- Template riga trattativa (usato da JS) -->
<template id="templateRigaTrattativa">
    <tr class="riga-trattativa" data-id="">
        <td class="text-center">
            <button class="btn btn-link btn-sm p-0 toggle-espandi" title="Espandi timeline">
                <i class="bi bi-chevron-right"></i>
            </button>
        </td>
        <td class="td-cliente">
            <a href="#" class="link-cliente text-decoration-none fw-medium"></a>
        </td>
        <td class="td-noleggiatore"></td>
        <td class="td-veicolo">
            <span class="marca"></span>
            <small class="text-muted descrizione d-block"></small>
        </td>
        <td class="td-tipologia"></td>
        <td class="td-tipo"></td>
        <td class="td-pezzi text-center"></td>
        <td class="td-stato">
            <span class="badge stato-badge"></span>
        </td>
        <td class="td-percentuale text-center">
            <div class="progress" style="height: 20px; min-width: 60px;">
                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
            </div>
        </td>
        <td class="td-data-inizio"></td>
        <td class="td-data-chiusura"></td>
        <td class="td-commerciale small">
            <span class="nome-commerciale"></span>
            <span class="badge bg-info badge-affidato d-none ms-1" title=""><i class="bi bi-person-plus-fill"></i></span>
        </td>
        <td class="td-azioni">
            <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary btn-avanzamento" title="Nuovo avanzamento">
                    <i class="bi bi-arrow-right-circle"></i>
                </button>
                <button class="btn btn-outline-secondary btn-modifica" title="Modifica">
                    <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-outline-danger btn-elimina" title="Elimina">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        </td>
    </tr>
</template>

<!-- Template riga espansa (timeline avanzamenti) -->
<template id="templateRigaEspansa">
    <tr class="riga-espansa table-light" data-parent="">
        <td colspan="12" class="py-2 px-4">
            <div class="timeline-container">
                <div class="d-flex align-items-center mb-2">
                    <strong class="me-2">Timeline Avanzamenti</strong>
                    <small class="text-muted">ID Trattativa: <span class="trattativa-id"></span></small>
                </div>
                <div class="timeline-items">
                    <!-- Popolato via JS -->
                </div>
            </div>
        </td>
    </tr>
</template>

<!-- Template singolo step timeline -->
<template id="templateTimelineStep">
    <div class="timeline-step d-flex align-items-start mb-2">
        <div class="timeline-marker me-2">
            <span class="badge rounded-pill" style="width: 12px; height: 12px;"></span>
        </div>
        <div class="timeline-content flex-grow-1">
            <div class="d-flex justify-content-between">
                <span class="stato-label fw-medium"></span>
                <small class="text-muted data-avanzamento"></small>
            </div>
            <small class="text-muted registrato-da"></small>
            <div class="note-avanzamento small fst-italic mt-1"></div>
        </div>
    </div>
</template>
